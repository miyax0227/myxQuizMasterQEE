{"headers":[{"key":"pos","value":true,"style":"boolean"},{"key":"nowLot","value":1,"style":"number"},{"key":"rule","value":0,"style":"number"}],"items":[{"key":"o","value":0,"style":"number","css":"o"},{"key":"x","value":0,"style":"number","css":"x","repeatChar":"×"}],"priority":[{"key":"status","order":"desc","alter":["win",2,"lose",0,1]},{"key":"o","order":"desc"}],"actions":[{"name":"○","css":"action_o","button_css":"btn btn-primary btn-lg","keyArray":"k1","tweet":"o","enable0":"return (player.status == 'normal' && !header.playoff && player.lot == header.nowLot && header.nowLot >= 1);","action0":"// ○を加算\nplayer.o++;\nsetMotion(player, 'o');\naddQCount(players, header, property);\n// ×を消す\nplayers.filter(function(player) {\n  return player.lot == header.nowLot;\n}).map(function(player) {\n  player.x = 0;\n});"},{"name":"×","css":"action_x","button_css":"btn btn-danger btn-lg","keyArray":"k2","tweet":"x","enable0":"return (player.status == 'normal' && !header.playoff && player.lot == header.nowLot && header.nowLot >= 1);","action0":"setMotion(player, 'x');\n// サイドアウトの場合\nif (header.rule == 1) {\n  player.x++;\n}\n// 1回休みルールの場合\nif (header.rule === 2) {\n  player.absent = 1;\n  player.status = \"preabsent\";\n  addQCount(players, header, property);\n}"},{"name":"s","css":"action_s","button_css":"btn btn-info btn-lg","keyArray":"k3","enable0":"return player.lot === 0;","action0":"player.lot = header.nowLot;"}],"global_actions":[{"name":"thru","button_css":"btn btn-default","group":"rule","keyboard":"Space","tweet":"thru","enable0":"return true;","action0":"addQCount(players, header, property);\n// ×を消す\nplayers.filter(function(player) {\n  return player.lot == header.nowLot;\n}).map(function(player) {\n  player.x = 0;\n});"},{"name":"Lose","button_css":"btn btn-default","group":"rule","keyboard":"z","enable0":"return true;","action0":"header.rule = 0;"},{"name":"SO","button_css":"btn btn-default","group":"rule","keyboard":"x","enable0":"return true;","action0":"header.rule = 1;"},{"name":"Abs","button_css":"btn btn-default","group":"rule","keyboard":"c","enable0":"return true;","action0":"header.rule = 2;"}],"global_actions_repeat":[{"name":"","button_css":"btn btn-default","group":"rule","indexes0":"return property.lots;","enable1":"return true;","action1":"header.nowLot = index;\nheader.qCount = 1;"}],"tweet":{"o":"${handleName}◯　→${o}◯ ${x}×","x":"${handleName}×　→${o}◯ ${x}× ${absent}休","thru":"スルー"},"judgement":"angular.forEach(players.filter(function(item) {\n  /* rankがない人かつ現在の組の人 */\n  return (item.rank === 0) && (item.lot == header.nowLot);\n}), function(player, i) {\n  /* win条件 */\n  if (player.o >= property.winningPoint) {\n    // 更にデュースありルールでは２点以上差がある場合\n    if (!property.deuce ||\n      players.filter(function(p) {\n        return (p !== player) && (p.lot == player.lot) && (p.o + 1 >= player.o);\n      }).length === 0) {\n\n      win(player, players, header, property);\n    }\n  }\n  /* lose条件 */\n  // 即失格ルールの場合\n  if (header.rule === 0 && player.x >= 1) {\n    lose(player, players, header, property);\n    // 相手は勝ち抜け\n    players.filter(function(p) {\n      return (p.lot == player.lot) && (p !== player);\n    }).map(function(p) {\n      win(p, players, header, property);\n    });\n  }\n});","calc":"// ルール名を設定する\nswitch (header.rule) {\n  case 0:\n    header.ruleName = \"1×失格\";\n    break;\n  case 1:\n    header.ruleName = \"サイドアウト\";\n    break;\n  case 2:\n    header.ruleName = \"1回休み\";\n    break;\n}\n// ２人とも×になった場合、×をリセットして次の問題へ\nif (players.filter(function(p) {\n    return p.lot == header.nowLot && p.x >= 1;\n  }).length >= 2) {\n  players.filter(function(p) {\n    return p.lot == header.nowLot && p.x >= 1;\n  }).map(function(p) {\n    p.x = 0;\n  });\n  addQCount(players, header, property);\n}\n\nvar key = 1;\nangular.forEach(players, function(player, index) {\n  player.pinch = false;\n  if (player.lot == header.nowLot && player.o + 1 >= property.winningPoint) {\n    // 更にデュースありルールでは２点以上差がある場合\n    if (!property.deuce ||\n      players.filter(function(p) {\n        return (p !== player) && (p.lot == player.lot) && (p.o >= player.o);\n      }).length === 0) {\n      player.chance = true;\n    } else {\n      player.chance = false;\n    }\n  } else {\n    player.chance = false;\n\n  }\n\n  // lotが0の場合は選択権ありプレイヤーを並べる\n  if (header.nowLot === 0) {\n    if (player.pos === 1) {\n      player.line = \"line1\";\n      player.keyIndex = player.lot;\n    } else {\n      player.line = \"left\";\n      player.keyIndex = 999;\n    }\n  } else {\n    // 当該組のプレイヤーが１人未満の場合\n    if (players.filter(function(p) {\n        return p.lot == header.nowLot;\n      }).length <= 1) {\n      // 当該組選択権ありプレイヤーを0番目、以降未未選択プレイヤーを並べる\n      if (player.pos === 1) {\n        if (player.lot == header.nowLot) {\n          player.line = \"line1\";\n          player.keyIndex = 0;\n        } else {\n          player.line = \"left\";\n          player.keyIndex = 999;\n        }\n      } else {\n        if (player.lot === 0) {\n          player.line = \"line1\";\n          player.keyIndex = (key++);\n        } else {\n          player.line = \"left\";\n          player.keyIndex = 999;\n        }\n      }\n\n      // 当該組のプレイヤーが２人の場合\n    } else {\n      if (player.lot == header.nowLot) {\n        player.line = \"line1\";\n        player.keyIndex = player.pos - 1;\n      } else {\n        player.line = \"left\";\n        player.keyIndex = 999;\n      }\n    }\n  }\n\n});","lines":[{"key":"line1","xType":true,"yType":false,"invisible":false,"zoom":1,"left":0,"right":1,"top":0,"y":0.5,"orderBy":"position"},{"key":"line2","orderBy":"priority","xType":true,"yType":false,"invisible":false,"zoom":1,"left":0,"right":1,"y":0.5}]}